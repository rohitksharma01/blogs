<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Building a QR Code Detector and Decoder with TensorFlow | QR Code Detector &amp; Decoder</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Building a QR Code Detector and Decoder with TensorFlow" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/qr-model-blog.html" />
<meta property="og:url" content="http://localhost:4000/qr-model-blog.html" />
<meta property="og:site_name" content="QR Code Detector &amp; Decoder" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Building a QR Code Detector and Decoder with TensorFlow" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","headline":"Building a QR Code Detector and Decoder with TensorFlow","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/qr_gradient_sample.png"}},"url":"http://localhost:4000/qr-model-blog.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
    <script src="/assets/js/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="/assets/css/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup theme-color -->
<!-- start theme color meta headers -->
<meta name="theme-color" content="#353535">
<meta name="msapplication-navbutton-color" content="#353535">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- end theme color meta headers -->


<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
      <div id="header">
        <nav>
          <ul>
            <li class="fork"><a href="">View On GitHub</a></li>
            
          </ul>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>QR Code Detector & Decoder</h1>
          <p></p>
          <hr>
          <span class="credits left">Project maintained by <a href=""></a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/mattgraham">mattgraham</a></span>
        </div>

        <h1 id="building-a-qr-code-detector-and-decoder-with-tensorflow">Building a QR Code Detector and Decoder with TensorFlow</h1>

<p><a href="./index.md">← Back to Home</a></p>

<h2 id="table-of-contents">Table of Contents</h2>
<ol>
  <li><a href="#1-data-generation">Data Generation</a></li>
  <li><a href="#2-model-architecture">Model Architecture</a></li>
  <li><a href="#3-training-pipeline">Training Pipeline</a></li>
  <li><a href="#4-inference-and-decoding-static-images">Inference and Decoding (Static Images)</a></li>
  <li><a href="#5-decoding-qr-codes-from-gifs">Decoding QR Codes from GIFs</a></li>
  <li><a href="#6-results-and-observations">Results and Observations</a></li>
  <li><a href="#7-results-gallery">Results Gallery</a></li>
  <li><a href="#8-tips-for-robustness">Tips for Robustness</a></li>
  <li><a href="#9-try-it-yourself">Try It Yourself</a></li>
  <li><a href="#10-references">References</a></li>
  <li><a href="#appendix-publish-as-a-github-pages-site">Appendix: Publish as a GitHub Pages Site</a></li>
</ol>

<hr />

<p>This post walks through how we:</p>
<ul>
  <li>Generated a large synthetic dataset of QR and non-QR images</li>
  <li>Trained a TensorFlow model to detect QR presence</li>
  <li>Decoded QR codes (including from animated GIFs) using OpenCV</li>
  <li>Applied multiple strategies to robustly decode difficult GIF QR codes</li>
</ul>

<p>The full project lives in this workspace. Key scripts:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">src/generate_qr.py</code>: QR generator with color, transparency, and background styles</li>
  <li><code class="language-plaintext highlighter-rouge">src/generate_non_qr.py</code>: Non-QR negative sample generator</li>
  <li><code class="language-plaintext highlighter-rouge">src/prepare_dataset.py</code>: Train/val split script</li>
  <li><code class="language-plaintext highlighter-rouge">src/model.py</code>: CNN architecture</li>
  <li><code class="language-plaintext highlighter-rouge">src/train.py</code>: Training pipeline</li>
  <li><code class="language-plaintext highlighter-rouge">src/infer_and_decode.py</code>: Image-level detection + decoding</li>
  <li><code class="language-plaintext highlighter-rouge">src/infer_gif.py</code>: GIF cumulative overlays + detection/decoding</li>
  <li><code class="language-plaintext highlighter-rouge">src/decode_animated_qr.py</code>: Multi-strategy GIF QR decoder</li>
</ul>

<h2 id="1-data-generation">1. Data Generation</h2>

<p>This is the most important bit, you need a lot of QRCodes to train your models. You can try doanloading as much as you want, but I wouldnt go that route. I asked AI to generate loads of QRcodes and non qr code images.</p>

<p>Being a simple guy and from a cybersecurity background I havent encountered funky QRCodes only the black ones, one I use daily for my gym entry and others for return labels from online shopping.</p>

<p>The initial model I created, easily detected the normal QRCodes and decoded them but then i let my curiosity run wild. 
Lets find QRCodes in giphy, our beloved gif playground. I immediately realized this model wont work for all use cases.</p>

<p>I encountered QR Codes of all shapes, size colors and what not. So I wanted to denerate QR Code accordingly, with different colors, backgrounds and noisy qrcodes.</p>

<p>I generated QR and non-QR images to build a robust binary classifier (QR vs non-QR).</p>

<ul>
  <li>QR styles:
    <ul>
      <li>Gradient backgrounds with colored QR and alpha</li>
      <li>Solid color backgrounds with colored QR</li>
      <li>Noisy backgrounds with classic B/W QR</li>
    </ul>
  </li>
</ul>

<p>Example commands:</p>
<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Colored + gradient background QR</span>
python3 src/generate_qr.py <span class="nt">--out</span> data/raw/qr_gradient <span class="nt">--count</span> 4000 <span class="nt">--size</span> 256 <span class="nt">--colored</span> <span class="nt">--bg-mode</span> gradient <span class="nt">--alpha-min</span> 0.4 <span class="nt">--alpha-max</span> 0.9

<span class="c"># Colored + solid background QR</span>
python3 src/generate_qr.py <span class="nt">--out</span> data/raw/qr_solid <span class="nt">--count</span> 3000 <span class="nt">--size</span> 256 <span class="nt">--colored</span> <span class="nt">--bg-mode</span> solid

<span class="c"># Classic QR on noisy background</span>
python3 src/generate_qr.py <span class="nt">--out</span> data/raw/qr_noisy <span class="nt">--count</span> 3000 <span class="nt">--size</span> 256 <span class="nt">--bg-mode</span> noisy

<span class="c"># Non-QR negatives</span>
python3 src/generate_non_qr.py <span class="nt">--out</span> data/raw/non_qr <span class="nt">--count</span> 10000 <span class="nt">--size</span> 256
</code></pre></div></div>

<p>Merge mixed QR styles and split:</p>
<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> data/raw/qr
<span class="nb">cp </span>data/raw/qr_gradient/<span class="k">*</span>.png data/raw/qr/
<span class="nb">cp </span>data/raw/qr_solid/<span class="k">*</span>.png data/raw/qr/
<span class="nb">cp </span>data/raw/qr_noisy/<span class="k">*</span>.png data/raw/qr/

python3 src/prepare_dataset.py <span class="nt">--raw-dir</span> data/raw <span class="nt">--out-dir</span> data/dataset <span class="nt">--val-ratio</span> 0.2
</code></pre></div></div>

<p>Example outputs:</p>

<p><img src="assets/qr_gradient_sample.png" alt="Colored QR on gradient background" /></p>

<p><strong>Caption:</strong> Colored QR with semi-transparent modules over a vertical gradient.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Detection: 100% confidence
Decoded: 74055288-cb33-4fe9-9bec-fdd6fc9ebd97
</code></pre></div></div>

<p><img src="assets/qr_solid_sample.png" alt="Colored QR on solid background" /></p>

<p><strong>Caption:</strong> Colored QR rendered on a solid pastel background.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Detection: 100% confidence
Decoded: (OpenCV could not extract - high transparency)
</code></pre></div></div>

<p><img src="assets/qr_noisy_sample.png" alt="Classic QR on noisy background" /></p>

<p><strong>Caption:</strong> Classic black/white QR composited onto a noisy textured background.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Detection: 100% confidence
Decoded: IwJurj8TZsKpketN5vICdibE5
</code></pre></div></div>

<h2 id="2-model-architecture">2. Model Architecture</h2>

<p>We used a compact CNN classifier (<code class="language-plaintext highlighter-rouge">src/model.py</code>) over 128x128 grayscale inputs:</p>
<ul>
  <li>Rescaling + light augmentation</li>
  <li>3 conv blocks with BatchNorm and MaxPool</li>
  <li>GlobalAveragePooling + dense layers</li>
  <li>Sigmoid output for QR presence</li>
</ul>

<p>Trainable parameters: ~615K.</p>

<h2 id="3-training-pipeline">3. Training Pipeline</h2>

<p>Training loads <code class="language-plaintext highlighter-rouge">data/dataset/{train,val}/{qr,non_qr}</code> via <code class="language-plaintext highlighter-rouge">image_dataset_from_directory</code>, converts to grayscale, and trains with early stopping and checkpointing.</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 src/train.py <span class="nt">--data-dir</span> data/dataset <span class="nt">--img-size</span> 128 <span class="nt">--batch-size</span> 128 <span class="nt">--epochs</span> 15 <span class="nt">--model-dir</span> models
</code></pre></div></div>

<p>Artifacts:</p>
<ul>
  <li>Best checkpoint: <code class="language-plaintext highlighter-rouge">models/qr_classifier.h5</code></li>
  <li>Keras SavedModel: <code class="language-plaintext highlighter-rouge">models/qr_classifier_savedmodel.keras</code></li>
</ul>

<h2 id="4-inference-and-decoding-static-images">4. Inference and Decoding (Static Images)</h2>

<p>For a static image, we first run the classifier to check if it likely contains a QR. If yes, we attempt to decode using OpenCV’s <code class="language-plaintext highlighter-rouge">QRCodeDetector</code>.</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 src/infer_and_decode.py <span class="nt">--image</span> path/to/image.png <span class="nt">--model</span> models/qr_classifier.h5 <span class="nt">--threshold</span> 0.5
</code></pre></div></div>

<p>If decoding succeeds, you’ll see the QR payload printed.</p>

<h2 id="5-decoding-qr-codes-from-gifs">5. Decoding QR Codes from GIFs</h2>

<p>Animated GIFs can be tricky. So we have to look into each frame or atleast a few of them to find and decode a QRCode.
There are different strategies, either look frame by frame or overlay frames to check if qw have a QRCode.</p>

<h3 id="51-cumulative-overlay-and-decode">5.1 Cumulative Overlay and Decode</h3>
<p><code class="language-plaintext highlighter-rouge">src/infer_gif.py</code> can:</p>
<ul>
  <li>Extract frames</li>
  <li>Overlay frames cumulatively (1..n) or overlay all frames</li>
  <li>Run detection and decode with OpenCV</li>
  <li>Save overlays to <code class="language-plaintext highlighter-rouge">tmp_cumulative_overlays/</code> for inspection</li>
</ul>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Cumulative overlays: save images, run detection and decode</span>
python3 src/infer_gif.py <span class="nt">--gif</span> assets/sunqr.gif <span class="nt">--model</span> models/qr_classifier.h5 <span class="nt">--threshold</span> 0.5 <span class="nt">--overlay-mode</span> cumulative <span class="nt">--blend-mode</span> average
</code></pre></div></div>

<p><strong>Example 1: Sun QR Code Animation</strong></p>

<p><img src="assets/sunqr.gif" alt="Sun QR Animation" /></p>

<p>This animated GIF features a QR code with a sun/radial background animation that cycles through different brightness levels.</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 src/decode_animated_qr.py <span class="nt">--gif</span> assets/sunqr.gif <span class="nt">--save-debug</span>
</code></pre></div></div>

<p><strong>Decoding Result:</strong> Successfully decoded using <strong>Strategy 1 (Individual frames)</strong>. The decoder extracted 15 frames from the animation and successfully decoded the QR code from the first frame.</p>

<p><strong>Decoded Output:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Awesome
</code></pre></div></div>

<p><strong>Example 2: Bird QR Code Animation</strong></p>

<p><img src="assets/birdqr.gif" alt="Bird QR Animation" /></p>

<p>This GIF shows a QR code overlaid on an animated bird background. The moving background elements present a challenge for detection.</p>

<div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 src/decode_animated_qr.py <span class="nt">--gif</span> assets/birdqr.gif <span class="nt">--save-debug</span>
</code></pre></div></div>

<p><strong>Decoding Result:</strong> Successfully decoded using <strong>Strategy 1 (Individual frames)</strong>. Despite only having 2 frames and an animated bird background, the decoder successfully extracted the QR code from the first frame.</p>

<p><strong>Decoded Output:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://ilovefreesoftware.com
</code></pre></div></div>

<h3 id="52-multi-strategy-animated-decoder">5.2 Multi-Strategy Animated Decoder</h3>
<p><code class="language-plaintext highlighter-rouge">src/decode_animated_qr.py</code> implements 5 strategies and exits immediately upon first successful decode:</p>

<ul>
  <li>Strategy 1: Individual frames</li>
  <li>Strategy 2: Enhanced frames (binary/otsu/adaptive thresholds, sharpening, contrast, denoise)</li>
  <li>Strategy 3: Cumulative overlays (average/max/median) + enhancements</li>
  <li>Strategy 4: Sliding window overlays</li>
  <li>Strategy 5: Frame differences</li>
</ul>

<p>The decoder automatically tries all strategies in sequence and stops at the first successful decode. Debug images are saved to <code class="language-plaintext highlighter-rouge">qr_decode_debug/</code> to help understand which approach worked.</p>

<p><strong>Key Learnings from Animated GIF Decoding:</strong></p>
<ul>
  <li>Animated backgrounds require different strategies depending on whether the QR itself is animated or static</li>
  <li>Median blending is particularly effective for static QR codes with animated backgrounds</li>
  <li>Individual frame enhancement works best when the QR code has consistent structure across frames</li>
  <li>Saving debug images helps identify which strategy worked and why</li>
</ul>

<h2 id="6-results-and-observations">6. Results and Observations</h2>

<ul>
  <li>The classifier confidently detects QR presence across diverse styles (colored, transparency, backgrounds).</li>
  <li>Decoding reliability depends on clarity and contrast; cumulative overlays can blur modules, so enhancements (thresholding, sharpening) often help.</li>
  <li>For animated GIF QR codes, trying multiple strategies increases the chance of decoding:
    <ul>
      <li>Individual frames may already contain a clean QR frame.</li>
      <li>Otsu/adaptive thresholding frequently recovers sufficient contrast.</li>
      <li>Sliding window overlays offer a good trade-off between noise reduction and sharpness.</li>
    </ul>
  </li>
</ul>

<h2 id="7-results-gallery">7. Results Gallery</h2>

<p>Below are decoded outputs from our test samples:</p>

<p><strong>Gradient Background QR:</strong></p>
<ul>
  <li>Image: <code class="language-plaintext highlighter-rouge">qr_gradient_sample.png</code></li>
  <li>Detection probability: 1.0000</li>
  <li>Decoded: <code class="language-plaintext highlighter-rouge">74055288-cb33-4fe9-9bec-fdd6fc9ebd97</code></li>
</ul>

<p><strong>Solid Background QR:</strong></p>
<ul>
  <li>Image: <code class="language-plaintext highlighter-rouge">qr_solid_sample.png</code></li>
  <li>Detection probability: 1.0000</li>
  <li>Decoded: <em>(QR detected but OpenCV couldn’t extract data — likely high transparency or color contrast issue)</em></li>
</ul>

<p><strong>Noisy Background QR:</strong></p>
<ul>
  <li>Image: <code class="language-plaintext highlighter-rouge">qr_noisy_sample.png</code></li>
  <li>Detection probability: 1.0000</li>
  <li>Decoded: <code class="language-plaintext highlighter-rouge">IwJurj8TZsKpketN5vICdibE5</code></li>
</ul>

<p>All samples were correctly identified as containing QR codes. Decoding success varies with contrast and module clarity.</p>

<h2 id="8-tips-for-robustness">8. Tips for Robustness</h2>

<ul>
  <li>Increase dataset diversity: scale, rotation, noise, blur, colors, backgrounds.</li>
  <li>Use more augmentation during training.</li>
  <li>Consider adding a segmentation or object-detection model to localize the QR region before decoding.</li>
  <li>For heavily animated GIFs, export frames and inspect overlays manually (we save them for you).</li>
</ul>

<h2 id="9-try-it-yourself">9. Try It Yourself</h2>

<ol>
  <li>Create venv and install deps:
    <div class="language-zsh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 <span class="nt">-m</span> venv .venv
<span class="nb">source</span> .venv/bin/activate
pip <span class="nb">install</span> <span class="nt">-r</span> requirements.txt
</code></pre></div>    </div>
  </li>
  <li>Generate data (as above), prepare dataset, and train.</li>
  <li>Run inference on images and GIFs using the commands provided.</li>
</ol>

<h2 id="10-references">10. References</h2>


      </section>

    </div>
  </body>
</html>
